
<!DOCTYPE html>
<html lang="zh-Hant">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="icon" type="image/png"
		href="data:image/png;base64,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" />
	<title>「亘古幻想」数据查询</title>
	<style>
		body {
			width: min(100%, 800px);
			margin: auto;
			padding: 0.5rem;
			box-sizing: border-box;
			font-family: "Noto Sans TC", "Noto Sans CJK TC", "Microsoft JhengHei", "PingFang TC", "Segoe UI", sans-serif;
		}

		a {
			color: inherit;
			text-decoration: none;
		}

		.chooseOption {
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 3px 0;
		}

		.chooseOption label {
			flex: 1;
			text-align: center;
		}

		#filterRarity,
		#filterElement,
		#filterWeaponType,
		#filterStars {
			border: 1px solid black;
			margin: 5px 0;
			padding: 5px;
			position: relative;
		}

		.toggleAll {
			position: absolute;
			top: 0;
			left: -0.4em;
			border: none;
			background: transparent;
			width: max(3%, 1em);
			height: 100%;
			padding: 0;
			font: inherit;
		}

		.toggleAll::before {
			position: absolute;
			content: "";
			top: 50%;
			left: 0;
			background-color: gray;
			border-radius: 50%;
			width: 0.8em;
			height: 1.2em;
			transform: translateY(-50%);
		}

		#targetSelect {
			width: 100%;
			height: 2em;
			margin: 10px auto;
			font-size: 1em;
			font-family: inherit;
		}

		/* Chrome, Safari, Edge */
		input[type="number"]::-webkit-outer-spin-button,
		input[type="number"]::-webkit-inner-spin-button {
			-webkit-appearance: none;
			margin: 0;
		}

		/* Firefox */
		input[type="number"] {
			appearance: textfied;
			-moz-appearance: textfield;
		}

		select {
			/* 隐藏 <select> 预设的箭头样式 */
			appearance: none;
			/* For modern browsers */
			-webkit-appearance: none;
			/* For Safari and Chrome */
			-moz-appearance: none;
			/* For Firefox */
			text-align: center;
			text-align-last: center;
			-moz-text-align-last: center;
		}

		option:first-child {
			text-align: center;
			text-align-last: center;
			-moz-text-align-last: center;
		}

		option:not(:first-child) {
			text-align: left;
		}

		.hidden {
			display: none !important;
		}

		hr {
			margin: 1.5em -0.5em 2em -0.5em;
		}

		#nameDisplay {
			position: relative;
		}

		#bigName {
			text-align: center;
			font-size: 3em;
			font-weight: bold;
		}

		#subName {
			text-align: center;
			font-size: 1.5em;
		}

		#codeName {
			position: absolute;
			top: -4em;
			right: 0px;
			font-size: 0.5em;
		}

		#viewContent {
			padding: 0.5em;
			margin-top: 2em;
		}

		#generalStatsArea {
			width: min(100%, 400px);
			margin: auto;
			padding: 0 0.5rem;
			border: 1px solid black;
			box-sizing: border-box;
		}

		.infoRow {
			display: flex;
			align-items: center;
			margin: 0.5rem auto;
		}

		.infoTitle {
			width: 30%;
			border: 1px solid black;
			text-align: justify;
			text-align-last: justify;
			padding: 0.2em;
		}

		.infoValue {
			width: 70%;
			text-align: center;
		}

		.areaTitle {
			text-align: center;
			font-size: 2em;
		}

		.contentBox {
			position: relative;
			border: 1px solid black;
			padding: 0.5em;
			min-height: 1.5em;
			box-sizing: border-box;
		}

		#hasAscended {
			margin-top: 1.5em;
		}

		#profileAscendedTitle {
			border: 1px solid black;
			font-size: 1.2em;
			width: 50%;
			text-align: justify;
			text-align-last: justify;
			margin: 0.5em auto;
		}

		#leaderSkillName,
		#weaponSkillName {
			border: 1px solid black;
			display: inline-block;
			margin: 0 auto 0.3em 1em;
			padding: 0 0.2em;
		}

		#activeSkillContent,
		#passiveSkillContent,
		#dialogContent,
		#relationshipContent {
			display: flex;
			flex-direction: column;
			gap: 0.5em;
		}

		.activeSkillDetail,
		.passiveSkillDetail {
			display: grid;
			grid-template-columns: 1fr minmax(10%, max-content) minmax(10%, max-content);
			align-items: center;
			border: 1px solid black;
			padding: 0.5em;
			gap: 0.4em;
		}

		.activeSkillName,
		.passiveSkillName,
		.relationshipName {
			display: inline-block;
			margin-left: 1em;
			border: 1px solid black;
			padding: 0 0.2em;
			width: fit-content;
		}

		.activeSkillSpirit,
		.activeSkillTU {
			text-align: center;
			border: 1px solid black;
			border-radius: 1em;
			height: 100%;
			place-content: center;
			padding: 0 0.5em;
		}

		.activeSkillDecription,
		.passiveSkillDecription,
		.relationshipMembers {
			grid-column: 1 / -1;
		}

		#dialogContent {
			gap: 1em;
		}

		.dialogGroupTitle {
			text-align: center;
			font-size: 1.2em;
		}

		.dialogText {
			border: 1px solid black;
			margin-top: 0.5em;
			padding: 0.5em;
		}

		label:has(input:disabled) {
			opacity: 0.5;
			pointer-events: none;
			cursor: not-allowed;
		}

		.relationshipAGroup {
			display: grid;
			grid-template-columns: 1fr 5em;
			align-items: center;
			border: 1px solid black;
			padding: 0.5em;
		}

		.relationshipBonus {
			text-align: center;
			border: 1px solid black;
			border-radius: 5em;
			height: 100%;
			place-content: center;
			padding: 0 0.5em;
			line-height: 1.1;
		}

		.relationshipAGroup ul {
			margin: 0.5em 1em;
			padding-left: 0.5em;
		}

		.collapseButton {
			position: absolute;
			left: 0;
			top: -0.25rem;
			background-color: transparent;
			border: 0;
			padding: 0;
			line-height: 1;
			transform: translate(-50%, -100%);
		}

		#selectableList {
			display: grid;
			grid-template-columns: 1fr auto;
			align-items: center;
		}
	</style>
</head>

<body>
	<div class="chooseOption" id="selectCategory">
		<label><input type="radio" name="unit_category" value="Monster" onchange="changeCategory()" checked />角色</label>
		<label><input type="radio" name="unit_category" value="Weapon" onchange="changeCategory()" />武器</label>
		<label><input type="radio" name="unit_category" value="Equipment" onchange="changeCategory()" />饰品</label>
	</div>

	<div id="filterRarity">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption">
			<label><input type="checkbox" value="N" onchange="setSelectableList(this)" checked />N</label>
			<label><input type="checkbox" value="R" onchange="setSelectableList(this)" checked />R</label>
			<label><input type="checkbox" value="SR" onchange="setSelectableList(this)" checked />SR</label>
			<label><input type="checkbox" value="SSR" onchange="setSelectableList(this)" checked />SSR</label>
		</div>
	</div>

	<div id="filterStars">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption">
			<label><input type="checkbox" value="0" onchange="setSelectableList(this)" checked />0★</label>
			<label><input type="checkbox" value="1" onchange="setSelectableList(this)" checked />1★</label>
			<label><input type="checkbox" value="2" onchange="setSelectableList(this)" checked />2★</label>
			<label><input type="checkbox" value="3" onchange="setSelectableList(this)" checked />3★</label>
			<label><input type="checkbox" value="4" onchange="setSelectableList(this)" checked />4★</label>
			<label><input type="checkbox" value="5" onchange="setSelectableList(this)" checked />5★</label>
			<label><input type="checkbox" value="6" onchange="setSelectableList(this)" checked />6★</label>
		</div>
	</div>

	<div id="filterElement" class="mo">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption">
			<label><input type="checkbox" value="Fire" onchange="setSelectableList(this)" checked />火</label>
			<label><input type="checkbox" value="Water" onchange="setSelectableList(this)" checked />水</label>
			<label><input type="checkbox" value="Earth" onchange="setSelectableList(this)" checked />地</label>
			<label><input type="checkbox" value="Air" onchange="setSelectableList(this)" checked />雷</label>
			<label><input type="checkbox" value="Life" onchange="setSelectableList(this)" checked />光</label>
			<label><input type="checkbox" value="Death" onchange="setSelectableList(this)" checked />暗</label>
		</div>
	</div>

	<div id="filterWeaponType" class="wo" style="display: none">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption" id="filterWeaponTypeYellow">
			<label><input type="checkbox" value="Sword" onchange="setSelectableList(this)" checked />单手剑</label>
			<label><input type="checkbox" value="Axe" onchange="setSelectableList(this)" checked />单手斧</label>
			<label><input type="checkbox" value="Staff" onchange="setSelectableList(this)" checked />法杖</label>
			<label><input type="checkbox" value="Mace" onchange="setSelectableList(this)" checked />钉头锤</label>
		</div>

		<div class="chooseOption" id="filterWeaponTypeRed">
			<label><input type="checkbox" value="GreatSword" onchange="setSelectableList(this)" checked />双手剑</label>
			<label><input type="checkbox" value="GreatAxe" onchange="setSelectableList(this)" checked />双手斧</label>
			<label><input type="checkbox" value="Spear" onchange="setSelectableList(this)" checked />长枪</label>
			<label><input type="checkbox" value="Hammer" onchange="setSelectableList(this)" checked />大槌</label>
			<label><input type="checkbox" value="Katana" onchange="setSelectableList(this)" checked />武士刀</label>
		</div>
	</div>

	<div id="selectableList">
		<select id="targetSelect" onchange="displayData()">
			<option value="" disabled selected hidden>▼ 选择目标 ▼</option>
		</select>
		<label><input type="checkbox" id="reverseToggle" onchange="reverseOptions()" value="false" />反序</label>
	</div>

	<hr style="margin: 1em -0.5em auto" />
	<div id="mainBlock" style="padding-top: 2em">
		<div id="nameDisplay">
			<div id="subName"></div>
			<div id="bigName"></div>
			<div id="codeName"></div>
		</div>

		<div id="viewContent">
			<div class="hidden" id="generalStatsArea">
				<div class="infoRow hidden" id="rarity">
					<div class="infoTitle">稀有度</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="stars">
					<div class="infoTitle">星级</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="preferredWeapon">
					<div class="infoTitle">擅长武器</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="weaponType">
					<div class="infoTitle">武器类型</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="element">
					<div class="infoTitle">属性</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="cost">
					<div class="infoTitle" style="text-align: center; text-align-last: center">Cost</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="atk">
					<div class="infoTitle">攻击力</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="hp">
					<div class="infoTitle">生命</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="speed">
					<div class="infoTitle">速度</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="power">
					<div class="infoTitle">
						<div>战力</div>
						<div id="powerHint" style="text-align: center; text-align-last: center; font-size: 0.7em">
							(基础能力值估算)
						</div>
					</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="freeEvo">
					<div class="infoTitle">自动进化</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="visible">
					<div class="infoTitle">图鉴可见</div>
					<div class="infoValue"></div>
				</div>
			</div>

			<div class="hidden" id="gachaIntroArea">
				<hr />
				<div class="areaTitle" id="profileTitle">召唤导言</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="gachaIntroContent">
						<div id="gachaIntroText" style="text-align: center"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="profileArea">
				<hr />
				<div class="areaTitle" id="profileTitle">简介</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="profileContent">
						<div id="profileText"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="leaderSkillArea">
				<hr />
				<div class="areaTitle" id="leaderSkillTitle">队长技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="leaderSkillContent">
						<div id="leaderSkillName"></div>
						<div id="leaderSkillDecription"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="weaponSkillArea">
				<hr />
				<div class="areaTitle" id="weaponSkillTitle">武器技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="weaponSkillContent">
						<div id="weaponSkillName"></div>
						<div id="weaponSkillDecription"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="activeSkillArea">
				<hr />
				<div class="areaTitle" id="activeSkillTitle">主动技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="activeSkillContent"></div>
				</div>
			</div>

			<div class="hidden" id="passiveSkillArea">
				<hr />
				<div class="areaTitle" id="passiveSkillTitle">被动技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="passiveSkillContent"></div>
				</div>
			</div>

			<div class="hidden" id="summonableMonstersArea">
				<hr />
				<div class="areaTitle" id="summonableMonstersTitle">召唤物</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="summonableMonstersContent"></div>
				</div>
			</div>

			<div class="hidden" id="dialogArea">
				<hr />
				<div class="areaTitle" id="dialogTitle">对话</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="dialogContent"></div>
				</div>
			</div>

			<div class="hidden" id="aiLogicArea">
				<hr />
				<div class="areaTitle" id="aiLogicTitle">仇恨值权重</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="aiLogicContent" style="white-space: pre-wrap"></div>
				</div>
			</div>

			<div class="hidden" id="relationshipArea">
				<hr />
				<div class="areaTitle" id="relationshipTitle">伙伴</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="relationshipContent"></div>
				</div>
			</div>
		</div>
	</div>

	<template id="template-hasAscended">
		<div id="hasAscended">
			<div id="profileAscendedTitle">・超越・</div>
			<div id="profileAscendedText"></div>
		</div>
	</template>

	<template id="template-activeSkill">
		<div class="activeSkillDetail">
			<div class="activeSkillName"></div>
			<div class="activeSkillSpirit"></div>
			<div class="activeSkillTU"></div>
			<div class="activeSkillDecription"></div>
		</div>
	</template>

	<template id="template-passiveSkill">
		<div class="passiveSkillDetail">
			<div class="passiveSkillName"></div>
			<div></div>
			<div></div>
			<div class="passiveSkillDecription"></div>
		</div>
	</template>

	<template id="template-dialog">
		<div class="dialogGroup">
			<div class="dialogGroupTitle"></div>
			<div class="dialogText"></div>
		</div>
	</template>

	<template id="template-relationship">
		<div class="relationshipAGroup">
			<div class="relationshipName"></div>
			<div class="relationshipBonus"></div>
			<div class="relationshipMembers"></div>
		</div>
	</template>

	<script>
		let unit_category = document.querySelector('input[name="unit_category"]:checked').value;
		let currentDisplayCategory = null;
		const wholeData = {};

		document.addEventListener("DOMContentLoaded", function () {
			const url = new URL(window.location.href);
			if (url.searchParams.has("lang")) {
				url.pathname = url.pathname.replace(/Viewer\d*/, "Viewer3");
				window.location.href = url.toString();
			}
		});

		document.addEventListener("DOMContentLoaded", initPage);

		async function initPage() {
			await initFilter();
			await loadWholeData();
			await setSelectableList();
			await analyzeUrlParams();
		}
	</script>

	<script>
		/*=====筛选逻辑区块=====*/
		const initSelectOptionContent = document.getElementById("targetSelect").innerHTML;

		function initFilter() {
			document.getElementById("selectCategory").querySelector('input[type="radio"]').checked = true;
			document.querySelectorAll('input[type="checkbox"]').forEach((c) => (c.checked = true));
			document.getElementById("reverseToggle").checked = false;
		}

		function changeCategory() {
			unit_category = document.querySelector('input[name="unit_category"]:checked').value;

			document.querySelectorAll(".mo, .wo").forEach(function (el) {
				el.style.display = "none";
			});

			if (unit_category === "Equipment") {
			} else {
				if (unit_category === "Weapon") {
					document.querySelectorAll(".wo").forEach(function (el) {
						el.style.display = "";
					});
				} else {
					document.querySelectorAll(".mo").forEach(function (el) {
						el.style.display = "";
					});
				}
			}

			document.querySelectorAll('.chooseOption input[type="checkbox"]').forEach((el) => (el.checked = true));
			document.getElementById("reverseToggle").checked = false;

			setSelectableList();
		}

		function setSelectableList(triggerElement) {
			const targetSelect = document.getElementById("targetSelect");
			targetSelect.innerHTML = initSelectOptionContent;

			const selectedRarities = Array.from(document.querySelectorAll("#filterRarity input:checked")).map(
				(cb) => cb.value
			);
			const selectedStars = Array.from(document.querySelectorAll("#filterStars input:checked")).map((cb) => cb.value);
			const selectedElements = Array.from(document.querySelectorAll("#filterElement input:checked")).map((cb) =>
				cb.parentNode.textContent.trim()
			);
			const selectedWeaponTypes = Array.from(document.querySelectorAll("#filterWeaponType input:checked")).map((cb) =>
				cb.parentNode.textContent.trim()
			);

			const filteredStars = new Set();

			for (const id in wholeData[unit_category]) {
				const entry = wholeData[unit_category][id];
				const option = document.createElement("option");

				if (!selectedRarities.includes(entry["稀有度"])) continue;
				if (unit_category === "Monster" && !selectedElements.includes(entry["属性"])) continue;
				if (unit_category === "Weapon" && !selectedWeaponTypes.includes(entry["类型"])) continue;

				filteredStars.add(entry["目前星数"]);
				if (!selectedStars.includes(String(entry["目前星数"]))) continue;

				option.value = id;
				option.text = getFullNameAddStarsOrRarity(id, unit_category, true, false);
				targetSelect.appendChild(option);
			}

			if (document.getElementById("reverseToggle").checked) reverseOptions();
			targetSelect.selectedIndex = 0;

			if (filteredStars.size !== 0) {
				//禁用没有的星数选项
				Array.from(document.querySelectorAll("#filterStars input")).forEach((cb) => {
					cb.disabled = false;
					if (!filteredStars.has(Number(cb.value))) {
						cb.checked = false;
						cb.disabled = true;
					}
				});

				//若非星数区块触发，且星数都未选，则全选
				const selectedStarsNew = Array.from(document.querySelectorAll("#filterStars input:checked")).map(
					(cb) => cb.value
				);
				if (triggerElement && !triggerElement.closest("#filterStars") && selectedStarsNew.length === 0) {
					document.querySelectorAll("#filterStars input").forEach((cb) => (cb.checked = true));
					setSelectableList();
				}
			}
		}

		function reverseOptions() {
			const selectableTarget = document.getElementById("targetSelect");
			const originalOptions = Array.from(selectableTarget.options).slice(1);
			const newOptions = originalOptions.reverse();
			selectableTarget.innerHTML = initSelectOptionContent;
			newOptions.forEach((option) => selectableTarget.appendChild(option));
			selectableTarget.selectedIndex = 0;
		}

		function toggleAllCheckboxes(toggleElement) {
			const checkboxes = toggleElement.parentElement.querySelectorAll('input[type="checkbox"]');

			// 检查目前是否全选
			const allChecked = Array.from(checkboxes)
				.filter((cb) => !cb.disabled)
				.every((cb) => cb.checked);
			checkboxes.forEach((cb) => (cb.checked = !allChecked));

			setSelectableList();
		}
	</script>

	<script>
		/*=====载入资料区块=====*/
		const dataUrls = {
			Monster: "https://ethantzj.github.io/evertale/Monster.json",
			Weapon: "https://evertale-playertw.github.io/Collection/Cht/Weapon.json",
			Equipment: "https://evertale-playertw.github.io/Collection/Cht/Accessory.json",
		};

		async function loadWholeData() {
			for (const [key, url] of Object.entries(dataUrls)) {
				try {
					const rawText = await fetch(url).then((res) => res.text());
					const jsonData = JSON.parse(rawText.replace(/\\(?![\\\/bfnrtu"])/g, "\\\\"));
					insertInfo(jsonData);
					wholeData[key] = jsonData;
				} catch (e) {
					console.error(`读取或解析 ${key} 时发生错误:`, e);
				}
			}
		}

		function insertInfo(jsonData) {
			for (const id in jsonData) {
				let fullName = jsonData[id]["名字"] || id;

				if (jsonData[id]["副名"]) {
					fullName += ` - ${jsonData[id]["副名"]}`;
				}
				jsonData[id]["完整名"] = fullName;

				if (jsonData[id]["星数"]) {
					jsonData[id]["目前星数"] = jsonData[id]["星数"].split("★").length - 1;
					jsonData[id]["最大星数"] = jsonData[id]["星数"].length;
				} else {
					jsonData[id]["目前星数"] = 0;
					jsonData[id]["最大星数"] = 0;
				}
			}
		}
	</script>

	<script>
		/*=====资讯显示区块=====*/
		const initTitle = document.title;

		function displayData(id, myCategory) {
			id ??= document.getElementById("targetSelect").value;
			if (id == "") return;

			currentDisplayCategory = myCategory ?? unit_category;

			collapseReset();
			document.title = `${wholeData[currentDisplayCategory][id]["完整名"]} | ${initTitle}`;

			document.getElementById("codeName").textContent = id;
			document.getElementById("bigName").textContent = wholeData[currentDisplayCategory][id]["名字"] || id;
			if (wholeData[currentDisplayCategory][id]["副名"]) {
				document.getElementById("subName").classList.remove("hidden");
				document.getElementById("subName").textContent = wholeData[currentDisplayCategory][id]["副名"];
			} else {
				document.getElementById("subName").classList.add("hidden");
			}

			setGeneralStats(id);
			setProfile(id);
			setLeaderSkill(id);
			setWeaponSkill(id);
			setActiveSkill(id);
			setPassiveSkill(id);
			setSummonableMonsters(id);
			setGachaIntro(id);
			setDialog(id);
			setAiLogic(id);
			setRelationship(id);

			document.getElementById("mainBlock").scrollIntoView();
		}

		function setGeneralStats(id) {
			document.getElementById("generalStatsArea").classList.remove("hidden");

			if (currentDisplayCategory === "Equipment") {
				document.querySelector("#atk .infoTitle").textContent = "攻击力";
				document.querySelector("#hp .infoTitle").textContent = "生命";
				document.getElementById("powerHint").classList.add("hidden");
			} else {
				document.querySelector("#atk .infoTitle").textContent = "基础攻击力";
				document.querySelector("#hp .infoTitle").textContent = "基础生命";
				document.getElementById("powerHint").classList.remove("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["稀有度"] != null) {
				document.getElementById("rarity").classList.remove("hidden");
				document.querySelector("#rarity .infoValue").textContent = wholeData[currentDisplayCategory][id]["稀有度"];
			} else {
				document.getElementById("rarity").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["星数"] != null) {
				document.getElementById("stars").classList.remove("hidden");
				document.querySelector("#stars .infoValue").textContent = wholeData[currentDisplayCategory][id]["星数"];
			} else {
				document.getElementById("stars").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["擅长武器"] != null) {
				document.getElementById("preferredWeapon").classList.remove("hidden");
				document.querySelector("#preferredWeapon .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["擅长武器"];
			} else {
				document.getElementById("preferredWeapon").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["类型"] != null) {
				document.getElementById("weaponType").classList.remove("hidden");
				document.querySelector("#weaponType .infoValue").textContent = wholeData[currentDisplayCategory][id]["类型"];
			} else {
				document.getElementById("weaponType").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["属性"] != null) {
				document.getElementById("element").classList.remove("hidden");
				document.querySelector("#element .infoValue").textContent = wholeData[currentDisplayCategory][id]["属性"];
			} else {
				document.getElementById("element").classList.add("hidden");
			}
			if (wholeData[currentDisplayCategory][id]["Cost"] != null) {
				document.getElementById("cost").classList.remove("hidden");
				document.querySelector("#cost .infoValue").textContent = wholeData[currentDisplayCategory][id]["Cost"];
			} else {
				document.getElementById("cost").classList.add("hidden");
			}

			if (
				(wholeData[currentDisplayCategory][id]["基础攻击力"] != null) |
				(wholeData[currentDisplayCategory][id]["攻击力"] != null)
			) {
				document.getElementById("atk").classList.remove("hidden");
				document.querySelector("#atk .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["基础攻击力"] ?? wholeData[currentDisplayCategory][id]["攻击力"];
			} else {
				document.getElementById("atk").classList.add("hidden");
			}

			if (
				(wholeData[currentDisplayCategory][id]["基础生命"] != null) |
				(wholeData[currentDisplayCategory][id]["生命"] != null)
			) {
				document.getElementById("hp").classList.remove("hidden");
				document.querySelector("#hp .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["基础生命"] ?? wholeData[currentDisplayCategory][id]["生命"];
			} else {
				document.getElementById("hp").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["速度"] != null) {
				document.getElementById("speed").classList.remove("hidden");
				document.querySelector("#speed .infoValue").textContent = wholeData[currentDisplayCategory][id]["速度"];
			} else {
				document.getElementById("speed").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["战力"] != null) {
				document.getElementById("power").classList.remove("hidden");
				document.querySelector("#power .infoValue").textContent = wholeData[currentDisplayCategory][id]["战力"];
			} else {
				document.getElementById("power").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["自动进化"] != null) {
				document.getElementById("freeEvo").classList.remove("hidden");
				const evoLv = `Lv.${wholeData[currentDisplayCategory][id]["自动进化"]["进化等级"]}`;
				const evoTarget = setNameAndLink(
					wholeData[currentDisplayCategory][id]["自动进化"]["进化目标"],
					"Monster",
					true,
					false
				);
				document.querySelector("#freeEvo .infoValue").innerHTML = `${evoLv}<br>${evoTarget.outerHTML}`;
			} else {
				document.getElementById("freeEvo").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["图鉴可见"]) {
				document.getElementById("visible").classList.remove("hidden");
				document.querySelector("#visible .infoValue").textContent = "✔";
			} else {
				document.getElementById("visible").classList.remove("hidden");
				document.querySelector("#visible .infoValue").textContent = "✗";
			}
		}

		function setProfile(id) {
			if (wholeData[currentDisplayCategory][id]["简介"]) {
				document.getElementById("profileArea").classList.remove("hidden");
				document.getElementById("profileText").innerText = wholeData[currentDisplayCategory][id]["简介"];

				document.getElementById("hasAscended")?.remove();
				if (wholeData[currentDisplayCategory][id]["简介_已超越(满觉)"] != null) {
					const templateHasAscended = document.getElementById("template-hasAscended").content.cloneNode(true);
					templateHasAscended.getElementById("profileAscendedText").innerText =
						wholeData[currentDisplayCategory][id]["简介_已超越(满觉)"];
					document.getElementById("profileContent").appendChild(templateHasAscended);
				}
			} else {
				document.getElementById("profileArea").classList.add("hidden");
			}
		}

		function setLeaderSkill(id) {
			if (wholeData[currentDisplayCategory][id]["队长技能"]) {
				document.getElementById("leaderSkillArea").classList.remove("hidden");
				document.getElementById("leaderSkillName").innerText =
					wholeData[currentDisplayCategory][id]["队长技能"]["技能标题"];
				document.getElementById("leaderSkillDecription").innerText =
					wholeData[currentDisplayCategory][id]["队长技能"]["技能叙述"];
			} else {
				document.getElementById("leaderSkillArea").classList.add("hidden");
			}
		}

		function setWeaponSkill(id) {
			if (wholeData[currentDisplayCategory][id]["武器技能"]) {
				document.getElementById("weaponSkillArea").classList.remove("hidden");
				document.getElementById("weaponSkillName").innerText =
					wholeData[currentDisplayCategory][id]["武器技能"][0]["技能标题"];
				document.getElementById("weaponSkillDecription").innerText =
					wholeData[currentDisplayCategory][id]["武器技能"][0]["技能叙述"];
			} else {
				document.getElementById("weaponSkillArea").classList.add("hidden");
			}
		}

		function setActiveSkill(id) {
			if (wholeData[currentDisplayCategory][id]["主动技能"]) {
				document.getElementById("activeSkillArea").classList.remove("hidden");
				document.getElementById("activeSkillContent").innerHTML = "";

				for (const [index, mySkill] of wholeData[currentDisplayCategory][id]["主动技能"].entries()) {
					const templateActiveSkill = document.getElementById("template-activeSkill").content.cloneNode(true);
					templateActiveSkill.querySelector(".activeSkillDetail").id = "activeSkill_" + (index + 1);
					templateActiveSkill.querySelector(".activeSkillName").innerText = mySkill["技能标题"];
					templateActiveSkill.querySelector(".activeSkillSpirit").innerText = "灵气 " + mySkill["灵气"];
					templateActiveSkill.querySelector(".activeSkillTU").innerText = mySkill["TU"] + " TU";
					templateActiveSkill.querySelector(".activeSkillDecription").innerText = mySkill["技能叙述"];

					document.getElementById("activeSkillContent").appendChild(templateActiveSkill);
				}
			} else {
				document.getElementById("activeSkillArea").classList.add("hidden");
			}
		}

		function setPassiveSkill(id) {
			if (wholeData[currentDisplayCategory][id]["被动技能"]) {
				document.getElementById("passiveSkillArea").classList.remove("hidden");
				document.getElementById("passiveSkillContent").innerHTML = "";

				for (const [index, mySkill] of wholeData[currentDisplayCategory][id]["被动技能"].entries()) {
					const templateActiveSkill = document.getElementById("template-passiveSkill").content.cloneNode(true);
					templateActiveSkill.querySelector(".passiveSkillDetail").id = "passiveSkill_" + (index + 1);
					templateActiveSkill.querySelector(".passiveSkillName").innerText = mySkill["技能标题"];
					templateActiveSkill.querySelector(".passiveSkillDecription").innerText = mySkill["技能叙述"];

					document.getElementById("passiveSkillContent").appendChild(templateActiveSkill);
				}
			} else {
				document.getElementById("passiveSkillArea").classList.add("hidden");
			}
		}

		function setGachaIntro(id) {
			if (wholeData[currentDisplayCategory][id]["召唤导言"]) {
				document.getElementById("gachaIntroArea").classList.remove("hidden");
				document.getElementById("gachaIntroText").innerText = wholeData[currentDisplayCategory][id]["召唤导言"];
			} else {
				document.getElementById("gachaIntroArea").classList.add("hidden");
			}
		}

		function setDialog(id) {
			if (wholeData[currentDisplayCategory][id]["对话"]) {
				document.getElementById("dialogArea").classList.remove("hidden");
				document.getElementById("dialogContent").innerHTML = "";

				const dailogSort = {
					Gacha: "召唤",
					Login: "主画面登入",
					Tap: "主画面点击",
					Idle: "主画面闲置",
				};

				for (const [key, title] of Object.entries(dailogSort)) {
					if (!wholeData[currentDisplayCategory][id]["对话"][title]) continue;

					const templateDialog = document.getElementById("template-dialog").content.cloneNode(true);
					templateDialog.querySelector(".dialogGroup").id = "dialog_" + key;
					templateDialog.querySelector(".dialogGroupTitle").innerText = title;

					for (const dialogText of wholeData[currentDisplayCategory][id]["对话"][title]) {
						if (!dialogText) continue;
						const templateDialogText = templateDialog.querySelector(".dialogText").cloneNode(true);
						templateDialogText.innerText = dialogText;
						templateDialog.querySelector(".dialogGroup").appendChild(templateDialogText);
					}
					//若无添加，则只有模板当初的2子元素
					if (templateDialog.querySelector(".dialogGroup").children.length <= 2) continue;

					templateDialog.querySelector(".dialogText").remove();
					document.getElementById("dialogContent").appendChild(templateDialog);
				}
			} else {
				document.getElementById("dialogArea").classList.add("hidden");
			}
		}

		function setAiLogic(id) {
			if (wholeData[currentDisplayCategory][id]["AI逻辑"]) {
				document.getElementById("aiLogicArea").classList.remove("hidden");
				//删除最外层的{}，并统一减少1缩排
				let jsonText = JSON.stringify(wholeData[currentDisplayCategory][id]["AI逻辑"], null, "\t");
				jsonText = jsonText.split("\n").slice(1, -1);
				jsonText = jsonText.map((line) => line.replace(/^\t/, ""));
				jsonText = jsonText.join("\n");

				document.getElementById("aiLogicContent").innerText = jsonText;
			} else {
				document.getElementById("aiLogicArea").classList.add("hidden");
			}
		}

		function getFullNameAddStarsOrRarity(id, category, addStars = true, addRarity = false) {
			let longName = wholeData[category][id]["完整名"];
			if (addStars) longName += ` (${wholeData[category][id]["星数"]})`;
			if (addRarity) longName += ` (${wholeData[category][id]["稀有度"]})`;
			return longName;
		}

		function analyzeUrlParams() {
			try {
				const params = new URLSearchParams(window.location.search);
				if (!params.toString()) return;
				history.replaceState(null, "", window.location.pathname);

				const id = params.get("id");
				let category = params.get("category");
				if (id || category) {
					if (!id && category) {
						//不能只有category
						throw new Error("id参数不可少");
					}

					if (id && !category) {
						//若没传入category则遍历搜寻
						category = (() => {
							for (const [type, ids] of Object.entries(wholeData)) {
								if (id in ids) return type;
							}
							throw new Error("id参数错误");
						})();
					}

					if (wholeData?.[category]?.[id]) {
						displayData(id, category);
					} else {
						throw new Error("id或category参数错误");
					}
				}
			} catch (e) {
				alert(e);
				console.error(e);
			}
		}

		function setNameAndLink(id, category, addStars = true, addRarity = false) {
			const linkElement = document.createElement("a");
			linkElement.href = `?id=${id}&category=${category}`;
			linkElement.textContent = getFullNameAddStarsOrRarity(id, category, addStars, addRarity);
			return linkElement;
		}

		function setSummonableMonsters(id) {
			if (wholeData[currentDisplayCategory][id]["召唤物"]) {
				document.getElementById("summonableMonstersArea").classList.remove("hidden");
				const combination = wholeData[currentDisplayCategory][id]["召唤物"]
					.map((conjureID) => setNameAndLink(conjureID, "Monster", true, false).outerHTML)
					.join("<br>");
				document.getElementById("summonableMonstersContent").innerHTML = combination;
			} else {
				document.getElementById("summonableMonstersArea").classList.add("hidden");
			}
		}

		function setRelationship(id) {
			if (wholeData[currentDisplayCategory][id]["伙伴"]) {
				document.getElementById("relationshipArea").classList.remove("hidden");
				document.getElementById("relationshipContent").innerHTML = "";

				for (const oneRelationship of Object.values(wholeData[currentDisplayCategory][id]["伙伴"])) {
					const templateRelationship = document.getElementById("template-relationship").content.cloneNode(true);
					templateRelationship.querySelector(".relationshipName").innerText = oneRelationship["伙伴关系"];
					templateRelationship.querySelector(".relationshipBonus").innerText = oneRelationship["伙伴加成"].replace(
						"+",
						"\n+"
					);

					const memberlist = document.createElement("ul");
					for (const charID of oneRelationship["伙伴成员"]) {
						const listItem = document.createElement("li");
						listItem.appendChild(setNameAndLink(charID, "Monster", false, true));
						memberlist.appendChild(listItem);
					}
					templateRelationship.querySelector(".relationshipMembers").appendChild(memberlist);

					document.getElementById("relationshipContent").appendChild(templateRelationship);
				}
			} else {
				document.getElementById("relationshipArea").classList.add("hidden");
			}
		}

		function collapseContent(triggerElement) {
			triggerElement.innerText = !triggerElement.nextElementSibling.classList.contains("hidden") ? "⊕" : "⊖";
			triggerElement.nextElementSibling.classList.toggle("hidden");
		}

		function collapseReset() {
			document.querySelectorAll(".collapseButton").forEach(function (el) {
				el.nextElementSibling.classList.remove("hidden");
				el.innerText = "⊖";
			});
		}
	</script>
</body>

</html>